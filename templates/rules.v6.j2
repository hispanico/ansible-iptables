# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!
### Mangle rules ###
*mangle
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
{% for rule in ip6tables_mangle_rules %}
{{rule}}
{% endfor %}
COMMIT
### END Mangle rules ###
### Nat rules ###
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
# Forwarded ports rules
{% for forward in ip6tables_forwarded_tcp_ports %}
-A PREROUTING -p tcp --dport {{forward.from}} -j REDIRECT --to-port {{forward.to}}
{% endfor %}
{% for forward in ip6tables_forwarded_udp_ports %}
-A PREROUTING -p udp --dport {{forward.from}} -j REDIRECT --to-port {{forward.to}}
{% endfor %}
# DNAT rules
{% for dnat in ip6tables_dnat_tcp %}
-A PREROUTING -i {{dnat.in_interface}} -p tcp -m tcp --dport {{dnat.from}} -j DNAT --to-destination {{dnat.to}}
{% endfor %}
{% for dnat in ip6tables_dnat_udp %}
-A PREROUTING -i {{dnat.in_interface}} -p udp -m udp --dport {{dnat.from}} -j DNAT --to-destination {{dnat.to}}
{% endfor %}
# SNAT rules
{% for snat in ip6tables_snat %}
-A POSTROUTING -s {{snat.from}} -o {{snat.out_interface}} -j SNAT --to-source {{snat.to}}
{% endfor %}
# Masquerade rules
{% for masquerade in ip6tables_masquerade %}
-A POSTROUTING -s {{masquerade.from}} -o {{masquerade.out_interface}} -j MASQUERADE
{% endfor %}
{% for rule in ip6tables_nat_rules %}
{{rule}}
{% endfor %}
COMMIT
### End Nat rules ###
### Filter rules ###
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# Accept all from localhost
-A INPUT -i lo -j ACCEPT
# Allowed sources.
{% for source in ip6tables_allowed_sources %}
-A INPUT -s {{source}} -j ACCEPT
{% endfor %}
# Allowed ports.
{% for port in ip6tables_allowed_tcp_ports %}
-A INPUT -p tcp -m tcp --dport {{port}} -j ACCEPT
{% endfor %}
{% for port in ip6tables_allowed_udp_ports %}
-A INPUT -p udp -m udp --dport {{port}} -j ACCEPT
{% endfor %}
{% for rule in ip6tables_filter_rules %}
{{rule}}
{% endfor %}
# Allow established connections:
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
{% if ip6tables_logging %}
# Logging
-A INPUT -m limit --limit 15/minute -j LOG --log-level 7 --log-prefix "Dropped by ip6tables: "
{% endif %}
{% if ip6tables_deny_all %}
# Drop all other
-A INPUT -j DROP
{% endif %}
COMMIT
### End Filter rules ###
